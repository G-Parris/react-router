import{w as F}from"./with-props-BjRVolG6.js";import{p as _,r as n,l as t}from"./chunk-KNED5TY2-B--Pu_Kb.js";import{s as l}from"./supabase-client-CQQklyuL.js";function O(){return[{title:"Task List"}]}const A=F(function(){const v=_(),[m,c]=n.useState([]),[h,i]=n.useState(void 0),[g,b]=n.useState({}),y=n.useRef({}),[E,U]=n.useState(!0);n.useEffect(()=>{l.from("tasks").select("*").order("created_at",{ascending:!1}).then(({data:r,error:s})=>{s?(i(s.message),c([])):(c(r||[]),i(void 0)),U(!1)})},[]);const C=m.filter(r=>(r.taskPriority==="Urgent"||r.taskPriority==="Critical")&&!r.completed),P=m.filter(r=>r.completed),T=m.filter(r=>!r.completed&&r.taskPriority!=="Urgent"&&r.taskPriority!=="Critical"),D=async(r,s)=>{try{if(!r.target.files||r.target.files.length===0)return;const e=r.target.files[0];b(f=>({...f,[s]:!0}));const a=new Date().getTime(),d=e.name.split(".").pop(),x=`${a}-${Math.random()}.${d}`,o=`${s}/${x}`,{error:j}=await l.storage.from("task-files").upload(o,e,{upsert:!0,cacheControl:"3600"});if(j)throw j;const{data:{publicUrl:N}}=l.storage.from("task-files").getPublicUrl(o),{error:w}=await l.from("tasks").update({fileUrl:N,updated_at:new Date().toISOString()}).eq("id",s);if(w)throw w;c(f=>f.map(u=>u.id===s?{...u,fileUrl:N}:u)),i(void 0)}catch(e){console.error("Error uploading file:",e),i(e instanceof Error?e.message:"Error uploading file")}finally{b(e=>({...e,[s]:!1}))}},S=async r=>{try{const{error:s}=await l.from("tasks").update({completed:!0,updated_at:new Date().toISOString()}).eq("id",r);if(s)throw s;c(e=>e.map(a=>a.id===r?{...a,completed:!0}:a)),i(void 0)}catch(s){console.error("Error marking task as completed:",s),i(s instanceof Error?s.message:"Error marking task as completed")}},k=async(r,s)=>{try{const e=s.split("/").pop();if(!e)throw new Error("Invalid file URL");const{error:a}=await l.storage.from("task-files").remove([`${r}/${e}`]);if(a)throw a;const{error:d}=await l.from("tasks").update({fileUrl:null,updated_at:new Date().toISOString()}).eq("id",r);if(d)throw d;c(x=>x.map(o=>o.id===r?{...o,fileUrl:null}:o)),i(void 0)}catch(e){console.error("Error deleting file:",e),i(e instanceof Error?e.message:"Error deleting file")}},$=(r,s)=>{r&&(y.current[s]=r)},p=({tasks:r,title:s})=>t.jsxs("div",{className:"min-w-full flex-none px-4 snap-start",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:s}),r.length===0?t.jsx("p",{className:"text-gray-500",children:"No tasks available."}):t.jsx("ul",{className:"space-y-4",children:r.map(e=>t.jsxs("li",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Task: ",e.taskName]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("input",{type:"file",ref:a=>$(a,e.id),onChange:a=>D(a,e.id),className:"hidden"}),!e.completed&&t.jsx("button",{onClick:()=>{var a;return(a=y.current[e.id])==null?void 0:a.click()},className:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm mr-2",disabled:g[e.id],children:g[e.id]?"Uploading...":"Upload File"}),e.fileUrl&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View File"}),!e.completed&&t.jsx("button",{onClick:()=>k(e.id,e.fileUrl),className:"text-red-500 hover:text-red-600 text-sm",children:"Delete File"})]})]})]}),t.jsxs("span",{className:`font-bold ${e.taskPriority==="Critical"?"text-red-600":e.taskPriority==="Urgent"?"text-orange-600":e.taskPriority==="High"?"text-yellow-500":e.taskPriority==="Medium"?"text-blue-600":"text-green-600"}`,children:["Priority: ",e.taskPriority]})]}),t.jsxs("p",{className:"mb-2 text-gray-900",children:["Description: ",e.taskDescription]}),t.jsxs("p",{className:"mb-2 text-gray-900",children:["Due Date: ",e.taskDueDate]}),t.jsxs("p",{className:"mb-2 text-gray-900",children:["Created At: ",e.created_at]}),t.jsxs("p",{className:"mb-2 text-gray-900",children:[e.completed?"Completed":"Last Updated",": ",e.updated_at]}),t.jsx("div",{className:"flex space-x-2 mt-2",children:!e.completed&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>v(`/task/${e.id}`),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded",children:"Edit Task"}),t.jsx("button",{onClick:()=>S(e.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded",children:"Mark Complete"})]})})]},e.id))})]});return E?t.jsx("div",{children:"Loading..."}):t.jsxs("div",{className:"container mx-auto overflow-hidden",children:[t.jsx("div",{className:"flex justify-between items-center mb-4 px-4",children:t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Tasks"})}),h&&t.jsx("p",{className:"text-red-500 px-4 mb-4",children:h}),t.jsxs("div",{className:"flex overflow-x-auto snap-x snap-mandatory",children:[t.jsx(p,{tasks:P,title:"Completed Tasks"}),t.jsx(p,{tasks:T,title:"Current Tasks"}),t.jsx(p,{tasks:C,title:"Urgent Tasks"})]})]})});export{A as default,O as meta};
